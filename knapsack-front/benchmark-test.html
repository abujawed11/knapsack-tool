<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Knapsack Algorithm Benchmark</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 30px;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 2.5em;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .input-section {
      margin-bottom: 30px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
    }

    .input-section h2 {
      margin-bottom: 20px;
      font-size: 1.5em;
      color: #333;
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    .input-group label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #555;
      font-size: 0.95em;
    }

    .input-group input {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.2s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .controls {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    button.primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    button.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    button.secondary {
      background: #6c757d;
      color: white;
    }

    button.secondary:hover {
      background: #5a6268;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .status {
      font-size: 14px;
      color: #666;
      padding: 8px 16px;
      background: white;
      border-radius: 6px;
      border: 2px solid #ddd;
    }

    .status.running {
      border-color: #667eea;
      color: #667eea;
      font-weight: 600;
    }

    #results {
      margin-top: 30px;
    }

    .test-case {
      margin-bottom: 40px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }

    .test-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
    }

    .test-header h3 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }

    .test-info {
      font-size: 0.95em;
      opacity: 0.95;
      line-height: 1.6;
    }

    .test-results {
      padding: 20px;
    }

    .algo-result {
      display: grid;
      grid-template-columns: 30px 200px 120px 150px 1fr;
      gap: 15px;
      padding: 15px;
      margin-bottom: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      align-items: start;
      transition: all 0.2s;
    }

    .algo-result:hover {
      background: #e9ecef;
      transform: translateX(5px);
    }

    .algo-result.passed {
      border-left: 4px solid #28a745;
    }

    .algo-result.failed {
      border-left: 4px solid #dc3545;
    }

    .status-icon {
      font-size: 24px;
      line-height: 1;
    }

    .algo-name {
      font-weight: 600;
      color: #333;
      font-size: 1.05em;
    }

    .time {
      font-family: 'Courier New', monospace;
      font-weight: 600;
      color: #667eea;
      font-size: 1.1em;
    }

    .status-text {
      font-size: 0.95em;
      color: #666;
    }

    .details {
      font-size: 0.9em;
      color: #555;
      line-height: 1.6;
    }

    .plan {
      background: white;
      padding: 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      margin-top: 5px;
    }

    .summary {
      margin-top: 40px;
      padding: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      color: white;
    }

    .summary h2 {
      margin-bottom: 20px;
      font-size: 2em;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .summary-card {
      background: rgba(255, 255, 255, 0.15);
      padding: 20px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
    }

    .summary-card h3 {
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .summary-stat {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 1.05em;
    }

    .summary-stat strong {
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .algo-result {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .container {
        padding: 15px;
      }

      h1 {
        font-size: 1.8em;
      }

      .input-grid {
        grid-template-columns: 1fr;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .controls button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Knapsack Algorithm Benchmark</h1>
    <p class="subtitle">Comparing 5 different optimization approaches for the unbounded knapsack problem</p>

    <div class="input-section">
      <h2>üìù Your Test Configuration</h2>
      <div class="input-grid">
        <div class="input-group">
          <label for="required">Required Length (mm)</label>
          <input type="number" id="required" value="5000" placeholder="e.g., 5000">
        </div>
        <div class="input-group">
          <label for="lengths">Available Cut Lengths (comma-separated)</label>
          <input type="text" id="lengths" value="500, 1000, 1500, 2000, 2500, 3000" placeholder="e.g., 500, 1000, 1500">
        </div>
        <div class="input-group">
          <label for="smallLengths">Small Lengths (comma-separated, optional)</label>
          <input type="text" id="smallLengths" value="500" placeholder="e.g., 500, 800">
        </div>
        <div class="input-group">
          <label for="maxPieces">Max Pieces (optional)</label>
          <input type="number" id="maxPieces" value="10" placeholder="e.g., 10">
        </div>
        <div class="input-group">
          <label for="alphaJoint">Alpha Joint Penalty</label>
          <input type="number" id="alphaJoint" value="220" placeholder="Default: 220">
        </div>
        <div class="input-group">
          <label for="betaSmall">Beta Small Penalty</label>
          <input type="number" id="betaSmall" value="60" placeholder="Default: 60">
        </div>
        <div class="input-group">
          <label for="gammaShort">Gamma Shortage Penalty</label>
          <input type="number" id="gammaShort" value="5" placeholder="Default: 5">
        </div>
        <div class="input-group">
          <label for="allowUndershoot">Allow Undershoot (%)</label>
          <input type="number" id="allowUndershoot" value="0" step="0.01" placeholder="e.g., 0.01 for 1%">
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="runBtn" class="primary" onclick="runCustomTest()">üöÄ Run Performance Test</button>
      <button onclick="runPredefinedTests()" class="secondary">üìä Run All Predefined Tests</button>
      <button onclick="clearResults()">Clear Results</button>
      <div id="status" class="status">Ready to run</div>
    </div>

    <div id="results"></div>
  </div>

  <script type="module">
    import { runBenchmark, TEST_CASES, ALGORITHMS } from './src/lib/optimizer-benchmark.js?v=1.1';

    let benchmarkResults = null;

    // Helper to parse comma-separated numbers
    function parseNumberList(str) {
      if (!str || str.trim() === '') return [];
      return str.split(',')
        .map(s => Number(s.trim()))
        .filter(n => Number.isFinite(n) && n > 0);
    }

    // Get config from input fields
    function getCustomConfig() {
      const required = Number(document.getElementById('required').value) || 0;
      const lengths = parseNumberList(document.getElementById('lengths').value);
      const smallLengths = parseNumberList(document.getElementById('smallLengths').value);
      const maxPieces = Number(document.getElementById('maxPieces').value) || undefined;
      const alphaJoint = Number(document.getElementById('alphaJoint').value) || 220;
      const betaSmall = Number(document.getElementById('betaSmall').value) || 60;
      const gammaShort = Number(document.getElementById('gammaShort').value) || 5;
      const allowUndershootPct = Number(document.getElementById('allowUndershoot').value) || 0;

      return {
        required,
        lengths,
        smallLengths,
        maxPieces,
        alphaJoint,
        betaSmall,
        gammaShort,
        allowUndershootPct
      };
    }

    // Run test with custom inputs
    window.runCustomTest = async function() {
      const config = getCustomConfig();

      if (!config.required || config.required <= 0) {
        alert('Please enter a valid required length.');
        return;
      }

      if (config.lengths.length === 0) {
        alert('Please enter at least one cut length.');
        return;
      }

      const resultsDiv = document.getElementById('results');
      const statusDiv = document.getElementById('status');
      const runBtn = document.getElementById('runBtn');

      resultsDiv.innerHTML = '';
      statusDiv.textContent = 'Running your custom test...';
      statusDiv.className = 'status running';
      runBtn.disabled = true;

      setTimeout(() => {
        try {
          runSingleTest({
            name: 'Your Custom Test',
            config
          });

          statusDiv.textContent = 'Test complete!';
          statusDiv.className = 'status';
          runBtn.disabled = false;
        } catch (error) {
          statusDiv.textContent = `Error: ${error.message}`;
          statusDiv.className = 'status';
          runBtn.disabled = false;
          console.error(error);
        }
      }, 100);
    };

    // Run all predefined tests
    window.runPredefinedTests = async function() {
      const resultsDiv = document.getElementById('results');
      const statusDiv = document.getElementById('status');
      const runBtn = document.getElementById('runBtn');

      resultsDiv.innerHTML = '';
      statusDiv.textContent = 'Running all predefined tests...';
      statusDiv.className = 'status running';
      runBtn.disabled = true;

      // Run benchmark in next tick to allow UI to update
      setTimeout(() => {
        try {
          // Custom runner with HTML output
          const results = runBenchmarkWithOutput();
          benchmarkResults = results;

          statusDiv.textContent = 'Benchmark complete!';
          statusDiv.className = 'status';
          runBtn.disabled = false;
        } catch (error) {
          statusDiv.textContent = `Error: ${error.message}`;
          statusDiv.className = 'status';
          runBtn.disabled = false;
          console.error(error);
        }
      }, 100);
    };

    window.clearResults = function() {
      document.getElementById('results').innerHTML = '';
      document.getElementById('status').textContent = 'Ready to run';
      document.getElementById('status').className = 'status';
    };

    // Run a single test case
    function runSingleTest(testCase) {
      const resultsDiv = document.getElementById('results');
      const algorithmNames = Object.keys(ALGORITHMS);

      const testDiv = document.createElement('div');
      testDiv.className = 'test-case';

      // Header
      const headerDiv = document.createElement('div');
      headerDiv.className = 'test-header';
      headerDiv.innerHTML = `
        <h3>${testCase.name}</h3>
        <div class="test-info">
          <div>Required Length: <strong>${testCase.config.required}mm</strong></div>
          <div>Available Lengths: <strong>[${testCase.config.lengths.join(', ')}]mm</strong></div>
          <div>Max Pieces: <strong>${testCase.config.maxPieces || 'unlimited'}</strong></div>
          ${testCase.config.smallLengths?.length ? `<div>Small Lengths: <strong>[${testCase.config.smallLengths.join(', ')}]mm</strong></div>` : ''}
          <div>Alpha Joint: <strong>${testCase.config.alphaJoint}</strong> | Beta Small: <strong>${testCase.config.betaSmall}</strong> | Gamma Short: <strong>${testCase.config.gammaShort}</strong></div>
        </div>
      `;
      testDiv.appendChild(headerDiv);

      // Results
      const resultsContainer = document.createElement('div');
      resultsContainer.className = 'test-results';

      for (const algoName of algorithmNames) {
        const algorithm = ALGORITHMS[algoName];
        const startTime = performance.now();

        let result;
        try {
          result = algorithm(testCase.config);
        } catch (error) {
          result = { ok: false, error: error.message };
        }

        const endTime = performance.now();
        const timeTaken = endTime - startTime;

        // Validate
        let passed = true;
        let reason = 'PASS';

        if (!result || result.error) {
          passed = false;
          reason = result?.error || 'No result';
        } else if (!result.ok) {
          passed = false;
          reason = result.reason || 'Failed';
        } else {
          // Basic validation
          const actualSum = result.plan.reduce((sum, x) => sum + x, 0);
          if (actualSum !== result.total) {
            passed = false;
            reason = 'Sum mismatch';
          }
        }

        // Create result element
        const resultDiv = document.createElement('div');
        resultDiv.className = `algo-result ${passed ? 'passed' : 'failed'}`;

        const statusIcon = passed ? '‚úì' : '‚úó';
        const details = result.ok ? `
          <div class="details">
            <div><strong>Pieces:</strong> ${result.pieces} | <strong>Total:</strong> ${result.total}mm | <strong>Extra:</strong> ${result.extra}mm | <strong>Cost:</strong> ${result.cost.toFixed(2)}</div>
            <div class="plan">Plan: [${result.plan.join(', ')}]</div>
          </div>
        ` : `<div class="details">${reason}</div>`;

        resultDiv.innerHTML = `
          <div class="status-icon">${statusIcon}</div>
          <div class="algo-name">${algoName}</div>
          <div class="time">${timeTaken.toFixed(2)}ms</div>
          <div class="status-text">${passed ? 'PASS' : reason}</div>
          ${details}
        `;

        resultsContainer.appendChild(resultDiv);
      }

      testDiv.appendChild(resultsContainer);
      resultsDiv.appendChild(testDiv);

      // Add summary for single test
      addSummaryForTest(algorithmNames, resultsContainer);
    }

    function addSummaryForTest(algorithmNames, resultsContainer) {
      const resultsDiv = document.getElementById('results');

      const summaryDiv = document.createElement('div');
      summaryDiv.className = 'summary';
      summaryDiv.innerHTML = '<h2>üìä Performance Summary</h2><div class="summary-grid"></div>';
      const summaryGrid = summaryDiv.querySelector('.summary-grid');

      const resultDivs = resultsContainer.querySelectorAll('.algo-result');

      algorithmNames.forEach((algoName, index) => {
        const resultDiv = resultDivs[index];
        const passed = resultDiv.classList.contains('passed');
        const timeText = resultDiv.querySelector('.time').textContent;
        const time = parseFloat(timeText);

        const card = document.createElement('div');
        card.className = 'summary-card';
        card.innerHTML = `
          <h3>${algoName}</h3>
          <div class="summary-stat">
            <span>Status:</span>
            <strong>${passed ? '‚úì PASS' : '‚úó FAIL'}</strong>
          </div>
          <div class="summary-stat">
            <span>Time:</span>
            <strong>${time.toFixed(2)}ms</strong>
          </div>
        `;
        summaryGrid.appendChild(card);
      });

      resultsDiv.appendChild(summaryDiv);
    }

    function runBenchmarkWithOutput() {
      const resultsDiv = document.getElementById('results');
      const allResults = [];
      const algorithmNames = Object.keys(ALGORITHMS);

      // Run each test case
      for (const testCase of TEST_CASES) {
        const testDiv = document.createElement('div');
        testDiv.className = 'test-case';

        // Header
        const headerDiv = document.createElement('div');
        headerDiv.className = 'test-header';
        headerDiv.innerHTML = `
          <h3>${testCase.name}</h3>
          <div class="test-info">
            <div>Required Length: <strong>${testCase.config.required}mm</strong></div>
            <div>Available Lengths: <strong>[${testCase.config.lengths.join(', ')}]mm</strong></div>
            <div>Max Pieces: <strong>${testCase.config.maxPieces || 'unlimited'}</strong></div>
            ${testCase.config.smallLengths?.length ? `<div>Small Lengths: <strong>[${testCase.config.smallLengths.join(', ')}]mm</strong></div>` : ''}
          </div>
        `;
        testDiv.appendChild(headerDiv);

        // Results
        const resultsContainer = document.createElement('div');
        resultsContainer.className = 'test-results';

        const testResults = {};

        for (const algoName of algorithmNames) {
          const algorithm = ALGORITHMS[algoName];
          const startTime = performance.now();

          let result;
          try {
            result = algorithm(testCase.config);
          } catch (error) {
            result = { ok: false, error: error.message };
          }

          const endTime = performance.now();
          const timeTaken = endTime - startTime;

          // Validate
          let passed = true;
          let reason = 'PASS';

          if (!result || result.error) {
            passed = false;
            reason = result?.error || 'No result';
          } else if (testCase.expected?.ok === false) {
            passed = result.ok === false;
            reason = passed ? 'PASS (Expected failure)' : 'Should have failed';
          } else if (!result.ok) {
            passed = false;
            reason = result.reason || 'Failed';
          } else {
            // Basic validation
            const actualSum = result.plan.reduce((sum, x) => sum + x, 0);
            if (actualSum !== result.total) {
              passed = false;
              reason = 'Sum mismatch';
            }
          }

          testResults[algoName] = { passed, reason, time: timeTaken, result };

          // Create result element
          const resultDiv = document.createElement('div');
          resultDiv.className = `algo-result ${passed ? 'passed' : 'failed'}`;

          const statusIcon = passed ? '‚úì' : '‚úó';
          const details = result.ok ? `
            <div class="details">
              <div><strong>Pieces:</strong> ${result.pieces} | <strong>Total:</strong> ${result.total}mm | <strong>Extra:</strong> ${result.extra}mm | <strong>Cost:</strong> ${result.cost.toFixed(2)}</div>
              <div class="plan">Plan: [${result.plan.join(', ')}]</div>
            </div>
          ` : `<div class="details">${reason}</div>`;

          resultDiv.innerHTML = `
            <div class="status-icon">${statusIcon}</div>
            <div class="algo-name">${algoName}</div>
            <div class="time">${timeTaken.toFixed(2)}ms</div>
            <div class="status-text">${passed ? 'PASS' : reason}</div>
            ${details}
          `;

          resultsContainer.appendChild(resultDiv);
        }

        testDiv.appendChild(resultsContainer);
        resultsDiv.appendChild(testDiv);

        allResults.push({ testCase: testCase.name, results: testResults });
      }

      // Add summary
      const summaryDiv = document.createElement('div');
      summaryDiv.className = 'summary';
      summaryDiv.innerHTML = '<h2>üìä Summary</h2><div class="summary-grid"></div>';
      const summaryGrid = summaryDiv.querySelector('.summary-grid');

      for (const algoName of algorithmNames) {
        const totalTests = allResults.length;
        const passed = allResults.filter(r => r.results[algoName]?.passed).length;
        const totalTime = allResults.reduce((sum, r) => sum + (r.results[algoName]?.time || 0), 0);
        const avgTime = totalTime / totalTests;

        const card = document.createElement('div');
        card.className = 'summary-card';
        card.innerHTML = `
          <h3>${algoName}</h3>
          <div class="summary-stat">
            <span>Tests Passed:</span>
            <strong>${passed}/${totalTests}</strong>
          </div>
          <div class="summary-stat">
            <span>Total Time:</span>
            <strong>${totalTime.toFixed(2)}ms</strong>
          </div>
          <div class="summary-stat">
            <span>Average Time:</span>
            <strong>${avgTime.toFixed(2)}ms</strong>
          </div>
        `;
        summaryGrid.appendChild(card);
      }

      resultsDiv.appendChild(summaryDiv);

      return allResults;
    }

    // Auto-run on load
    // window.addEventListener('load', () => {
    //   setTimeout(runBenchmark, 500);
    // });
  </script>
</body>
</html>
